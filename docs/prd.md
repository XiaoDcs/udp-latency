项目目标
实现一个无人机之间的UDP通信测试系统。该系统的核心目标是发送UDP数据包，跟踪每个数据包的发送、接收状态（是否丢失、何时到达），计算丢包率和单向延迟，并将这些通信性能指标与无人机在测试期间的实时位置（GPS）和通信模块的关键状态信息进行关联。最终输出一个包含所有这些信息的、带时间戳的完整CSV或JSON格式的日志报告，用于后续分析。
注意事项：GPS数据和通信模块数据，是有对应接口的，你可以预留一下，不需要在代码里体现
详细需求总结
1. UDP通信测试核心功能：
  ○ 数据包发送与接收： 在两台无人机（分别称为发送端和接收端）上的Ubuntu机载电脑之间进行单向UDP数据包传输。
  ○ 唯一标识： 每个发送的UDP包必须有一个唯一的序列号，用于跟踪和匹配。
  ○ 时间戳记录：
    ■ 发送端：记录每个UDP包的精确发送时间戳。
    ■ 接收端：记录每个UDP包的精确接收时间戳。
  ○ 丢包检测： 通过对比发送端和接收端的序列号记录，识别丢失的数据包。
  ○ 延迟计算： 基于同步时钟，通过接收时间戳与数据包内嵌的原始发送时间戳计算单向延迟。
  ○ 配置参数： UDP包的发送速率和核心数据部分的大小应可配置。
2. 数据记录与集成：
  ○ UDP包内数据：
    ■ 必需： 序列号、高精度发送时间戳。
    ■ 可选（若小巧且关键）： 发送端即时的RSSI或其他关键通信指标。
  ○ 无人机状态本地独立记录（每台无人机）：
    ■ GPS数据： 以一定频率（如1Hz, 5Hz）记录本机当前GPS坐标（纬度、经度、高度等），附带高精度时间戳。
    ■ 通信模块数据： 以一定频率记录本机通信模块的详细状态信息（如链路质量、噪声水平、发送/接收功率、更详细的RSSI等），附带高精度时间戳。
  ○ 日志输出：
    ■ 发送端：记录已发送UDP包的日志（序列号、发送时间戳、包大小等）。
    ■ 接收端：记录已接收UDP包的日志（序列号、原始发送时间戳、接收时间戳、来源IP等）。
    ■ 无人机状态：每台无人机分别记录其GPS和通信模块状态日志。
  ○ 最终报告： 生成一个统一的CSV或JSON Lines格式的综合报告。报告中的每一条记录（或相关联的记录）应能清晰展示： 
    ■ 特定序列号的UDP包的发送时间、接收时间（如果收到）、延迟。
    ■ 该包是否丢失。
    ■ 发送时，发送端无人机的位置和通信状态。
    ■ 接收时（如果收到），接收端无人机的位置和通信状态。
3. 系统与环境：
  ○ 平台： 两台无人机，每台搭载Ubuntu机载电脑。
  ○ 网络： 无人机间通过特定通信模块组网，IP网段为 192.168.104.0/24。
  ○ 时间同步： 两台机载电脑的系统时钟必须严格同步，以保证单向延迟计算的准确性和跨日志数据关联的有效性。
4. 关注点：
  ○ 避免IP分片： UDP测试包（IP头 + UDP头 + UDP有效负载）的总大小应小于无人机间通信链路的路径MTU，以避免IP分片影响测试结果的纯粹性。因此，UDP有效负载本身应设计得尽可能小。
  ○ 应用层感知性能： 测试结果应能反映应用层面实际感受到的通信质量。
技术方案总结
1. 核心组件（Python脚本）：
  ○ UDP发送脚本 (udp_sender.py) - 运行于发送端无人机：
    ■ 功能：
      ● 按配置的速率生成UDP数据包。
      ● 每个数据包内嵌一个唯一的、单调递增的序列号和当前的发送时间戳（高精度，如 time.time()）。
      ● （可选）在包内嵌入一个非常小巧的关键瞬时通信指标，如发送端RSSI。
      ● 将UDP包发送到接收端无人机的指定IP和端口。
      ● 将每个已发送包的详细信息（序列号、发送时间戳、包大小、可选瞬时指标）记录到本地CSV/JSON日志文件。
    ■ 配置： 接收端IP、端口、发送速率、UDP负载目标大小（不含IP/UDP头）。
  ○ UDP接收脚本 (udp_receiver.py) - 运行于接收端无人机：
    ■ 功能：
      ● 监听指定的UDP端口。
      ● 每接收到一个UDP包，立即记录当前的接收时间戳（高精度）。
      ● 从包的有效负载中解析出序列号和原始发送时间戳。
      ● （可选）获取接收端即时的关键通信指标。
      ● 将每个成功接收包的详细信息（序列号、原始发送时间戳、接收时间戳、来源IP、可选瞬时指标）记录到本地CSV/JSON日志文件。
  ○ 本地数据记录器脚本 (例如 local_monitor.py 或拆分为 gps_logger.py 和 comms_logger.py) - 在两台无人机上独立运行：
    ■ 功能：
      ● 独立于UDP收发脚本运行。
      ● 以配置的频率（例如，每秒1次、5次或10次）周期性执行。
      ● 调用相应的接口或库获取当前无人机的GPS位置信息（经度、纬度、高度等）。
      ● 调用相应的接口或库获取当前无人机通信模块的详细状态信息。
      ● 将获取到的GPS数据和通信模块数据，各自连同高精度时间戳，分别记录到本地的CSV/JSON日志文件（例如 drone_A_gps.csv, drone_A_comms.csv, drone_B_gps.csv 等）。
  ○ 数据后处理与分析脚本 (analyzer.py) - 测试完成后在地面计算机上运行：
    ■ 功能：
      ● 收集来自两台无人机的所有日志文件（发送端UDP日志、接收端UDP日志、两台无人机的GPS日志、两台无人机的通信模块日志）。
      ● 使用Pandas等Python库进行数据处理： 
        a. 合并发送端和接收端的UDP日志，基于序列号匹配，从而识别已发送、已接收和已丢失的数据包。
        b. 对于成功接收的包，计算单向延迟（接收时间戳 - 原始发送时间戳）。
        c. 将处理后的UDP事件数据（包含发送时间、接收时间、延迟、丢包状态）与各自无人机的GPS日志和通信模块日志进行合并。合并的关键是时间戳，采用最近邻匹配 (pandas.merge_asof 是一个理想的函数) 将每个UDP发送/接收事件与其发生时最接近的GPS记录和通信模块状态记录关联起来。
      ● 生成最终的综合分析报告，格式为CSV或JSON Lines，包含所有关联信息，便于进一步分析和可视化。
2. 关键支撑机制：
  ○ 严格的时间同步：
    ■ 方法： 在两台无人机的Ubuntu系统上配置和运行NTP客户端。
    ■ 推荐软件：chrony，因其对网络不稳定和时钟漂移的鲁棒性更适合无人机环境。
    ■ 时间源策略（优先级从高到低）：
      1. 每台无人机使用GPS+PPS作为本地高精度时间源：这是最理想的方案，提供最高的自主性和准确性。需要GPS模块支持PPS输出，并正确配置gpsd和chrony以使用PPS信号。
      2. 本地NTP服务器：如果只有一台无人机或地面站（GCS）有GPS+PPS，则该设备可作为NTP服务器，为网络内其他无人机提供时间。其他无人机配置为NTP客户端指向此服务器。
      3. 公共互联网NTP服务器池：仅适用于地面准备或测试前可以稳定连接互联网的场景。
    ■ 重要性： 精确同步的时钟是准确计算单向延迟和可靠合并分布式时间序列日志的绝对前提。
  ○ UDP数据包设计：
    ■ 核心负载： 包含序列号（例如4字节整数）、发送时间戳（例如8字节浮点数或拆分为秒和纳秒的整数）。
    ■ 可选负载： 若有极小且关键的瞬时通信指标（如1-2字节的RSSI值），可考虑加入。
    ■ 格式： 可以选择紧凑的JSON（短键名）或者自定义的二进制结构（使用Python的struct模块打包/解包）来进一步减小开销。
    ■ 目标： 保持UDP有效负载非常小（例如几十到一百多字节），加上IP头（20字节）和UDP头（8字节）后，总大小远小于链路的Path MTU（例如，如果PMTU是500字节，则UDP负载应小于472字节），以确保测试的纯粹性，避免IP分片。
1. 数据流与工作流程：
  a. 准备阶段： 确保两台无人机系统时钟通过NTP（最好是基于GPS+PPS的chrony）严格同步。配置并启动所有脚本（UDP发送、接收、本地数据记录器）。
  b. 测试执行： 发送端无人机按设定速率发送包含序列号和发送时间戳的UDP包，并记录发送日志。接收端无人机接收UDP包，记录接收日志。两台无人机上的本地数据记录器脚本并行记录各自的GPS和通信模块状态。
  c. 测试结束： 停止所有脚本。
  d. 数据收集： 从两台无人机上收集所有生成的日志文件。
  e. 数据处理与分析： 在地面计算机上运行analyzer.py脚本，该脚本整合所有日志数据，计算性能指标，并生成最终的综合报告。